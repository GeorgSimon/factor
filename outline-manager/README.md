It works but the code is ugly.

continued in ../kullulu
